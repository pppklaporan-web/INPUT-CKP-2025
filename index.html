<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Unggah File CKP 2025</title>
  <style>
    :root{--primary:#006eb6;--bg1:#eaf4fc;--bg2:#fff}
    body{font-family:Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .card{width:100%;max-width:480px;background:#fff;border-radius:16px;padding:28px;box-shadow:0 8px 24px rgba(0,0,0,0.08);text-align:center}
    .logo img{width:110px;height:auto;border-radius:8px;margin-bottom:8px}
    h2{color:var(--primary);margin:6px 0 18px}
    label{text-align:left;display:block;margin-top:12px;font-weight:600;color:#333}
    input[type=text],select,input[type=file]{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-top:6px;box-sizing:border-box}
    .btn{width:100%;background:var(--primary);color:#fff;border:none;padding:12px;border-radius:8px;font-weight:700;margin-top:16px;cursor:pointer}
    .progress{height:10px;background:#f3f3f3;border-radius:8px;overflow:hidden;margin-top:12px;display:none}
    .bar{height:100%;width:0;background:var(--primary);transition:width .25s}
    .info{display:none;margin-top:14px;padding:12px;border-radius:8px;font-size:14px}
    .info.success{background:#e9f8ec;border:1px solid #2e7d32;color:#2e7d32}
    .info.error{background:#fdecea;border:1px solid #c62828;color:#c62828}
    footer{font-size:12px;color:#777;margin-top:14px}
  </style>
</head>
<body>
    <div class="container">
      <h2>Unggah File SKP 2025</h2>
      <form id="uploadForm">
        <label>Nama Pegawai</label>
        <input id="nama" type="text" required placeholder="Masukkan nama lengkap" />
        <label>Bulan (Folder Tujuan)</label>
        <select id="bulan" required>
          <option value="">Pilih Bulan</option>
          <option>JANUARI</option><option>FEBRUARI</option><option>MARET</option>
          <option>APRIL</option><option>MEI</option><option>JUNI</option>
          <option>JULI</option><option>AGUSTUS</option><option>SEPTEMBER</option>
          <option>OKTOBER</option><option>NOVEMBER</option><option>DESEMBER</option>
        </select>
        <label>File PDF</label>
        <input id="file" type="file" accept=".pdf" required />
        <button type="submit">Unggah Sekarang</button>
      </form>
      <div id="result" class="result"></div>
      <footer>¬© 2025 BPS Provinsi Sumatera Barat</footer>
    </div>
    <script>
      const scriptURL = "https://script.google.com/macros/s/AKfycbzeOJwDKCcMm6Ctdwy5LCoB9xu-QcOv4vPHQH_Wv6cgdhR504WkSe8GuhJ6hye2ZNRDQg/exec";
      document.getElementById("uploadForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        const nama = document.getElementById("nama").value.trim();
        const bulan = document.getElementById("bulan").value;
        const fileInput = document.getElementById("file");
        const result = document.getElementById("result");
        if (!nama || !bulan || !fileInput.files.length) {
          alert("Mohon lengkapi semua data!");
          return;
        }
        const file = fileInput.files[0];
        if (file.type !== "application/pdf") {
          alert("Hanya file PDF yang diperbolehkan!");
          return;
        }
        const reader = new FileReader();
        reader.onload = async function (event) {
          const base64Data = event.target.result.split(",")[1];
          result.style.display = "block";
          result.className = "result";
          result.textContent = "‚è≥ Mengunggah ke Google Drive...";
          try {
            const res = await fetch(scriptURL, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                nama: nama,
                bulan: bulan,
                filename: file.name,
                filedata: base64Data,
              }),
            });
            const json = await res.json();
            if (json.success) {
              result.classList.add("success");
              result.innerHTML =
                "‚úÖ " + json.message +
                "<br><b>" + json.fileName + "</b><br><a href='" + json.fileUrl +
                "' target='_blank'>üîó Lihat di Drive</a>";
            } else {
              result.classList.add("error");
              result.textContent = "‚ùå Gagal: " + json.message;
            }
          } catch (err) {
            console.error(err);
            result.classList.add("error");
            result.textContent = "‚ö†Ô∏è Terjadi kesalahan saat mengunggah file.";
          }
        };
        reader.readAsDataURL(file);
      });
    </script>
  </body>
</html>
