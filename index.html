<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Unggah File CKP 2025</title>
  <style>
    :root{--primary:#006eb6;--bg1:#eaf4fc;--bg2:#fff}
    body{font-family:Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
    .card{width:100%;max-width:480px;background:#fff;border-radius:16px;padding:28px;box-shadow:0 8px 24px rgba(0,0,0,0.08);text-align:center}
    .logo img{width:110px;height:auto;border-radius:8px;margin-bottom:8px}
    h2{color:var(--primary);margin:6px 0 18px}
    label{text-align:left;display:block;margin-top:12px;font-weight:600;color:#333}
    input[type=text],select,input[type=file]{width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-top:6px;box-sizing:border-box}
    .btn{width:100%;background:var(--primary);color:#fff;border:none;padding:12px;border-radius:8px;font-weight:700;margin-top:16px;cursor:pointer}
    .progress{height:10px;background:#f3f3f3;border-radius:8px;overflow:hidden;margin-top:12px;display:none}
    .bar{height:100%;width:0;background:var(--primary);transition:width .25s}
    .info{display:none;margin-top:14px;padding:12px;border-radius:8px;font-size:14px}
    .info.success{background:#e9f8ec;border:1px solid #2e7d32;color:#2e7d32}
    .info.error{background:#fdecea;border:1px solid #c62828;color:#c62828}
    footer{font-size:12px;color:#777;margin-top:14px}
  </style>
</head>
<body>
  <div class="card">
    
    <h2>Unggah File CKP 2025</h2>

    <label>Nama Pegawai</label>
    <input id="nama" type="text" placeholder="Masukkan nama lengkap">

    <label>Bulan (Folder Tujuan)</label>
    <select id="bulanSelect"></select>

    <label>File PDF</label>
    <input id="pdfFile" type="file" accept="application/pdf">

    <button class="btn" id="uploadBtn">Unggah Sekarang</button>

    <div class="progress" id="progress"><div class="bar" id="bar"></div></div>
    <div id="result" class="info"></div>

    <footer>Â© 2025 BPS Provinsi Sumatera Barat</footer>
  </div>

 <script>
      const form = document.getElementById("form");
      const submitButton = document.getElementById("submit-button");
      const messageDiv = document.getElementById("message");
      const fileInput = document.getElementById("fileInput");
      const fileNameDisplay = document.getElementById("fileNameDisplay");

      fileInput.addEventListener("change", function () {
        if (this.files && this.files.length > 0) {
          fileNameDisplay.textContent = this.files[0].name;
        } else {
          fileNameDisplay.textContent = "No file selected";
        }
      });

      async function uploadFile(file) {
        return new Promise((resolve, reject) => {
          const fr = new FileReader();
          fr.onload = (e) => {
            const data = e.target.result.split(",");
            const obj = {
              fileName: file.name,
              mimeType: data[0].match(/:(\w.+);/)[1],
              data: data[1],
            };
            resolve(obj);
          };
          fr.onerror = reject;
          fr.readAsDataURL(file);
        });
      }

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        messageDiv.textContent = "Submitting...";
        messageDiv.style.display = "block";
        messageDiv.style.backgroundColor = "beige";
        messageDiv.style.color = "black";
        submitButton.disabled = true;
        submitButton.classList.add("is-loading");

        try {
          const formData = new FormData(this);
          const formDataObj = {};

          for (let [key, value] of formData.entries()) {
            formDataObj[key] = value;
          }

          if (fileInput.files.length > 0) {
            const fileObj = await uploadFile(fileInput.files[0]);
            formDataObj.fileData = fileObj;
          }

          const scriptURL = "https://script.google.com/macros/s/AKfycby_Wz09XLAbX1qRQAo6eoaOO4e1py5F8-4KInnFX0M4lPKxsvzybsmoojXLwo4rPzmt/exec";

          const response = await fetch(scriptURL, {
            redirect: "follow",
            method: "POST",
            body: JSON.stringify(formDataObj),
            headers: { "Content-Type": "text/plain;charset=utf-8" },
          });

          const data = await response.json();

          if (data.status === "success") {
            messageDiv.textContent = data.message || "Data submitted successfully!";
            messageDiv.style.backgroundColor = "#ff3e00";
            messageDiv.style.color = "white";
            form.reset();
            fileNameDisplay.textContent = "No file selected";
          } else {
            throw new Error(data.message || "Submission failed");
          }
        } catch (error) {
          console.error("Error:", error);
          messageDiv.textContent = "Error: " + error.message;
          messageDiv.style.backgroundColor = "#f14668";
          messageDiv.style.color = "white";
        } finally {
          submitButton.disabled = false;
          submitButton.classList.remove("is-loading");
          setTimeout(() => {
            messageDiv.textContent = "";
            messageDiv.style.display = "none";
          }, 4000);
        }
      });

      const cancelButton = form.querySelector("button.is-danger");
      cancelButton.addEventListener("click", function () {
        form.reset();
        fileNameDisplay.textContent = "No file selected";
        messageDiv.style.display = "none";
      });
    </script>
  </body>
</html>

